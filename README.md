**AWS Health AWS_RISK_CREDENTIALS_EXPOSED**

This example demonstrates how to use AWS Step Functions to orchestrate a serverless AWS Lambda workflow in response to an Amazon CloudWatch Event generated by AWS Health.

AWS proactively monitors popular code repository sites for exposed AWS Identity and Access Management (IAM) access keys.

On detection of an exposed IAM access key, AWS Health generates an AWS_RISK_CREDENTIALS_EXPOSED CloudWatch Event.

In response to this event, an automated workflow deletes the exposed IAM Access Key, summarizes the recent API activity for the exposed key, and sends the summary message to an Amazon Simple Notification Service (SNS) Topic to notify the subscribers- all orchestrated by an AWS Step Functions state machine.

This repository contains sample code for all the Lambda functions depicted in the diagram below as well as an AWS CloudFormation template for creating the functions and related resources.

![image-20230601-122704](https://github.com/user-attachments/assets/d2a29cf7-eb69-4d3c-bb0f-38969fd38df6)

**Walkthrough of the Architecture**

An IAM Access Key is inadvertently uploaded to one of the popular code repositories monitored by AWS.
AWS Health detects the key, generating a AWS_RISK_CREDENTIALS_EXPOSED CloudWatch Event. AWS also temporarily restricts the API calls the key is able to make.

A configured CloudWatch Events rule matches this event, triggering an execution of the ExposedKey state machine, which has the following sub-steps:

1. Disable the exposed IAM Access Key Pair. If there is an error in this step then skip to the last step.
2. Summarize recent API activity for the user from CloudTrail.
3. Send security notification message containing summary to SecurityNotificationTopic SNS Topic. If there was an error in the first step notify security that the error occurred and the incident requires manual inspection and intervention.
